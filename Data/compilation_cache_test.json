[
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f():\n    jax.random.normal(jax.random.key(0), 1000)"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f():\n    jax.random.normal(jax.random.key(0), 1000)"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f():\n    jax.random.normal(jax.random.key(0), 1000)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f():\n    jax.random.normal(jax.random.key(0), 1000)"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f():\n    jax.random.normal(jax.random.key(0), 1000)"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f():\n    jax.random.normal(jax.random.key(0), 1000)"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f():\n    jax.random.normal(jax.random.key(0), 1000)"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f():\n    jax.random.normal(jax.random.key(0), 1000)"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f():\n    jax.random.normal(jax.random.key(0), 1000)"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, abstracted_axes=(None, 'n'))\ndef f(x):\n    return x[0]"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, abstracted_axes=(None, 'n'))\ndef f(x):\n    return x[0]"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, abstracted_axes=(None, 'n'))\ndef f(x):\n    return x[0]"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, abstracted_axes=(None, 'n'))\ndef f(x):\n    return x[0]"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, abstracted_axes=(None, 'n'))\ndef f(x):\n    return x[0]"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, abstracted_axes=(None, 'n'))\ndef f(x):\n    return x[0]"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, abstracted_axes=(None, 'n'))\ndef f(x):\n    return x[0]"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, abstracted_axes=(None, 'n'))\ndef f(x):\n    return x[0]"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, abstracted_axes=(None, 'n'))\ndef f(x):\n    return x[0]"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def zeros(shape):\n    if not isinstance(shape, (tuple, list)):\n        shape = (shape,)\n    return lax.broadcast(jnp.float32(0.0), shape)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef g():\n    return jnp.zeros(n) + x"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x):\n    y = x + 2\n    return (jnp.nan, y)"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x):\n    y = x + 2\n    return (jnp.nan, y)"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x):\n    y = x + 2\n    return (jnp.nan, y)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x):\n    y = x + 2\n    return (jnp.nan, y)"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x):\n    y = x + 2\n    return (jnp.nan, y)"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x):\n    y = x + 2\n    return (jnp.nan, y)"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x):\n    y = x + 2\n    return (jnp.nan, y)"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x):\n    y = x + 2\n    return (jnp.nan, y)"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x):\n    y = x + 2\n    return (jnp.nan, y)"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n    x, y = jax.lax.cond(x < 3, lambda x, y: (x * 2, y), lambda x, y: (x * 3, y), x, y)\n    return (x, y)"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n    x, y = jax.lax.cond(x < 3, lambda x, y: (x * 2, y), lambda x, y: (x * 3, y), x, y)\n    return (x, y)"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n    x, y = jax.lax.cond(x < 3, lambda x, y: (x * 2, y), lambda x, y: (x * 3, y), x, y)\n    return (x, y)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n    x, y = jax.lax.cond(x < 3, lambda x, y: (x * 2, y), lambda x, y: (x * 3, y), x, y)\n    return (x, y)"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n    x, y = jax.lax.cond(x < 3, lambda x, y: (x * 2, y), lambda x, y: (x * 3, y), x, y)\n    return (x, y)"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n    x, y = jax.lax.cond(x < 3, lambda x, y: (x * 2, y), lambda x, y: (x * 3, y), x, y)\n    return (x, y)"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n    x, y = jax.lax.cond(x < 3, lambda x, y: (x * 2, y), lambda x, y: (x * 3, y), x, y)\n    return (x, y)"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n    x, y = jax.lax.cond(x < 3, lambda x, y: (x * 2, y), lambda x, y: (x * 3, y), x, y)\n    return (x, y)"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n    x, y = jax.lax.cond(x < 3, lambda x, y: (x * 2, y), lambda x, y: (x * 3, y), x, y)\n    return (x, y)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def g():\n    return jax.lax.cond(True, lambda: data[0], lambda: data[1])"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x):\n    return 0.0 / x"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x):\n    return 0.0 / x"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x):\n    return 0.0 / x"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x):\n    return 0.0 / x"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x):\n    return 0.0 / x"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x):\n    return 0.0 / x"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x):\n    return 0.0 / x"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x):\n    return 0.0 / x"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x):\n    return 0.0 / x"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f():\n    weird_dict = {lambda x: x: 2.0, lambda x: x * 2: 3}\n    weirder_dict = {lambda x: x: weird_dict}\n    x = 2.0\n    debugger.breakpoint(stdin=stdin, stdout=stdout, backend='cli')\n    del weirder_dict\n    return x"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f():\n    weird_dict = {lambda x: x: 2.0, lambda x: x * 2: 3}\n    weirder_dict = {lambda x: x: weird_dict}\n    x = 2.0\n    debugger.breakpoint(stdin=stdin, stdout=stdout, backend='cli')\n    del weirder_dict\n    return x"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f():\n    weird_dict = {lambda x: x: 2.0, lambda x: x * 2: 3}\n    weirder_dict = {lambda x: x: weird_dict}\n    x = 2.0\n    debugger.breakpoint(stdin=stdin, stdout=stdout, backend='cli')\n    del weirder_dict\n    return x"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f():\n    weird_dict = {lambda x: x: 2.0, lambda x: x * 2: 3}\n    weirder_dict = {lambda x: x: weird_dict}\n    x = 2.0\n    debugger.breakpoint(stdin=stdin, stdout=stdout, backend='cli')\n    del weirder_dict\n    return x"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f():\n    weird_dict = {lambda x: x: 2.0, lambda x: x * 2: 3}\n    weirder_dict = {lambda x: x: weird_dict}\n    x = 2.0\n    debugger.breakpoint(stdin=stdin, stdout=stdout, backend='cli')\n    del weirder_dict\n    return x"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f():\n    weird_dict = {lambda x: x: 2.0, lambda x: x * 2: 3}\n    weirder_dict = {lambda x: x: weird_dict}\n    x = 2.0\n    debugger.breakpoint(stdin=stdin, stdout=stdout, backend='cli')\n    del weirder_dict\n    return x"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f():\n    weird_dict = {lambda x: x: 2.0, lambda x: x * 2: 3}\n    weirder_dict = {lambda x: x: weird_dict}\n    x = 2.0\n    debugger.breakpoint(stdin=stdin, stdout=stdout, backend='cli')\n    del weirder_dict\n    return x"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f():\n    weird_dict = {lambda x: x: 2.0, lambda x: x * 2: 3}\n    weirder_dict = {lambda x: x: weird_dict}\n    x = 2.0\n    debugger.breakpoint(stdin=stdin, stdout=stdout, backend='cli')\n    del weirder_dict\n    return x"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f():\n    weird_dict = {lambda x: x: 2.0, lambda x: x * 2: 3}\n    weirder_dict = {lambda x: x: weird_dict}\n    x = 2.0\n    debugger.breakpoint(stdin=stdin, stdout=stdout, backend='cli')\n    del weirder_dict\n    return x"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef g():\n    debugger.breakpoint(stdin=stdin, stdout=stdout, backend='cli')"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x):\n    out = jnp.zeros_like(x)\n\n    def body(i, j, k, refs):\n        x_ref, out_ref = refs\n        y = func(x_ref[i, j, k])\n        out_ref[i, j, k] += y\n    return for_loop.for_loop(x.shape, body, (x, out))[1].sum()"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x):\n    out = jnp.zeros_like(x)\n\n    def body(i, j, k, refs):\n        x_ref, out_ref = refs\n        y = func(x_ref[i, j, k])\n        out_ref[i, j, k] += y\n    return for_loop.for_loop(x.shape, body, (x, out))[1].sum()"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x):\n    out = jnp.zeros_like(x)\n\n    def body(i, j, k, refs):\n        x_ref, out_ref = refs\n        y = func(x_ref[i, j, k])\n        out_ref[i, j, k] += y\n    return for_loop.for_loop(x.shape, body, (x, out))[1].sum()"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x):\n    out = jnp.zeros_like(x)\n\n    def body(i, j, k, refs):\n        x_ref, out_ref = refs\n        y = func(x_ref[i, j, k])\n        out_ref[i, j, k] += y\n    return for_loop.for_loop(x.shape, body, (x, out))[1].sum()"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x):\n    out = jnp.zeros_like(x)\n\n    def body(i, j, k, refs):\n        x_ref, out_ref = refs\n        y = func(x_ref[i, j, k])\n        out_ref[i, j, k] += y\n    return for_loop.for_loop(x.shape, body, (x, out))[1].sum()"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x):\n    out = jnp.zeros_like(x)\n\n    def body(i, j, k, refs):\n        x_ref, out_ref = refs\n        y = func(x_ref[i, j, k])\n        out_ref[i, j, k] += y\n    return for_loop.for_loop(x.shape, body, (x, out))[1].sum()"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x):\n    out = jnp.zeros_like(x)\n\n    def body(i, j, k, refs):\n        x_ref, out_ref = refs\n        y = func(x_ref[i, j, k])\n        out_ref[i, j, k] += y\n    return for_loop.for_loop(x.shape, body, (x, out))[1].sum()"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x):\n    out = jnp.zeros_like(x)\n\n    def body(i, j, k, refs):\n        x_ref, out_ref = refs\n        y = func(x_ref[i, j, k])\n        out_ref[i, j, k] += y\n    return for_loop.for_loop(x.shape, body, (x, out))[1].sum()"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x):\n    out = jnp.zeros_like(x)\n\n    def body(i, j, k, refs):\n        x_ref, out_ref = refs\n        y = func(x_ref[i, j, k])\n        out_ref[i, j, k] += y\n    return for_loop.for_loop(x.shape, body, (x, out))[1].sum()"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def g(a, b):\n    c = jnp.zeros_like(a)\n    _, b, c, _ = for_impl(5, body2, (a, b, c, 0))\n    return (b, c)"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(a, b, c, d, e):\n    return (a, b, c, d, e)"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(a, b, c, d, e):\n    return (a, b, c, d, e)"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(a, b, c, d, e):\n    return (a, b, c, d, e)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(a, b, c, d, e):\n    return (a, b, c, d, e)"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(a, b, c, d, e):\n    return (a, b, c, d, e)"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(a, b, c, d, e):\n    return (a, b, c, d, e)"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(a, b, c, d, e):\n    return (a, b, c, d, e)"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(a, b, c, d, e):\n    return (a, b, c, d, e)"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(a, b, c, d, e):\n    return (a, b, c, d, e)"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    return jsp.special.betainc(jnp.ones(3), 1.0, x)"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    return jsp.special.betainc(jnp.ones(3), 1.0, x)"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    return jsp.special.betainc(jnp.ones(3), 1.0, x)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    return jsp.special.betainc(jnp.ones(3), 1.0, x)"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    return jsp.special.betainc(jnp.ones(3), 1.0, x)"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    return jsp.special.betainc(jnp.ones(3), 1.0, x)"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    return jsp.special.betainc(jnp.ones(3), 1.0, x)"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    return jsp.special.betainc(jnp.ones(3), 1.0, x)"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    return jsp.special.betainc(jnp.ones(3), 1.0, x)"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    return jnp.add(3.0, 4.0)"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    return jnp.add(3.0, 4.0)"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    return jnp.add(3.0, 4.0)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    return jnp.add(3.0, 4.0)"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    return jnp.add(3.0, 4.0)"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    return jnp.add(3.0, 4.0)"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    return jnp.add(3.0, 4.0)"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    return jnp.add(3.0, 4.0)"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    return jnp.add(3.0, 4.0)"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n    z = jax_getattr(thing1, 'x')\n    w = jax_getattr(thing2, 'x')\n    out = jnp.sin(x * y * z * w)\n    jax_setattr(thing1, 'x', out)\n    jax_setattr(thing2, 'x', 2 * out)\n    return (3 * out, 4 * out)"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n    z = jax_getattr(thing1, 'x')\n    w = jax_getattr(thing2, 'x')\n    out = jnp.sin(x * y * z * w)\n    jax_setattr(thing1, 'x', out)\n    jax_setattr(thing2, 'x', 2 * out)\n    return (3 * out, 4 * out)"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n    z = jax_getattr(thing1, 'x')\n    w = jax_getattr(thing2, 'x')\n    out = jnp.sin(x * y * z * w)\n    jax_setattr(thing1, 'x', out)\n    jax_setattr(thing2, 'x', 2 * out)\n    return (3 * out, 4 * out)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n    z = jax_getattr(thing1, 'x')\n    w = jax_getattr(thing2, 'x')\n    out = jnp.sin(x * y * z * w)\n    jax_setattr(thing1, 'x', out)\n    jax_setattr(thing2, 'x', 2 * out)\n    return (3 * out, 4 * out)"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n    z = jax_getattr(thing1, 'x')\n    w = jax_getattr(thing2, 'x')\n    out = jnp.sin(x * y * z * w)\n    jax_setattr(thing1, 'x', out)\n    jax_setattr(thing2, 'x', 2 * out)\n    return (3 * out, 4 * out)"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n    z = jax_getattr(thing1, 'x')\n    w = jax_getattr(thing2, 'x')\n    out = jnp.sin(x * y * z * w)\n    jax_setattr(thing1, 'x', out)\n    jax_setattr(thing2, 'x', 2 * out)\n    return (3 * out, 4 * out)"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n    z = jax_getattr(thing1, 'x')\n    w = jax_getattr(thing2, 'x')\n    out = jnp.sin(x * y * z * w)\n    jax_setattr(thing1, 'x', out)\n    jax_setattr(thing2, 'x', 2 * out)\n    return (3 * out, 4 * out)"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n    z = jax_getattr(thing1, 'x')\n    w = jax_getattr(thing2, 'x')\n    out = jnp.sin(x * y * z * w)\n    jax_setattr(thing1, 'x', out)\n    jax_setattr(thing2, 'x', 2 * out)\n    return (3 * out, 4 * out)"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n    z = jax_getattr(thing1, 'x')\n    w = jax_getattr(thing2, 'x')\n    out = jnp.sin(x * y * z * w)\n    jax_setattr(thing1, 'x', out)\n    jax_setattr(thing2, 'x', 2 * out)\n    return (3 * out, 4 * out)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef g():\n    _, _, attr_tangents = attrs.jvp(f, (), (), [(thing, 'x', 1.0)])\n    (thing_, attr_, tangent_), = attr_tangents\n    self.assertIs(thing, thing_)\n    self.assertEqual(attr_, 'x')\n    return (jax_getattr(thing, 'x'), tangent_)"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.vmap\n@jax.value_and_grad\n@jax.named_scope('foo')\ndef f(x):\n\n    @jax.named_scope('scan_body')\n    def body(carry, x):\n        return (carry * x, carry + x)\n    return lax.scan(body, x, jnp.arange(8.0))[0]"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.vmap\n@jax.value_and_grad\n@jax.named_scope('foo')\ndef f(x):\n\n    @jax.named_scope('scan_body')\n    def body(carry, x):\n        return (carry * x, carry + x)\n    return lax.scan(body, x, jnp.arange(8.0))[0]"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.vmap\n@jax.value_and_grad\n@jax.named_scope('foo')\ndef f(x):\n\n    @jax.named_scope('scan_body')\n    def body(carry, x):\n        return (carry * x, carry + x)\n    return lax.scan(body, x, jnp.arange(8.0))[0]"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.vmap\n@jax.value_and_grad\n@jax.named_scope('foo')\ndef f(x):\n\n    @jax.named_scope('scan_body')\n    def body(carry, x):\n        return (carry * x, carry + x)\n    return lax.scan(body, x, jnp.arange(8.0))[0]"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.vmap\n@jax.value_and_grad\n@jax.named_scope('foo')\ndef f(x):\n\n    @jax.named_scope('scan_body')\n    def body(carry, x):\n        return (carry * x, carry + x)\n    return lax.scan(body, x, jnp.arange(8.0))[0]"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.vmap\n@jax.value_and_grad\n@jax.named_scope('foo')\ndef f(x):\n\n    @jax.named_scope('scan_body')\n    def body(carry, x):\n        return (carry * x, carry + x)\n    return lax.scan(body, x, jnp.arange(8.0))[0]"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.vmap\n@jax.value_and_grad\n@jax.named_scope('foo')\ndef f(x):\n\n    @jax.named_scope('scan_body')\n    def body(carry, x):\n        return (carry * x, carry + x)\n    return lax.scan(body, x, jnp.arange(8.0))[0]"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.vmap\n@jax.value_and_grad\n@jax.named_scope('foo')\ndef f(x):\n\n    @jax.named_scope('scan_body')\n    def body(carry, x):\n        return (carry * x, carry + x)\n    return lax.scan(body, x, jnp.arange(8.0))[0]"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.vmap\n@jax.value_and_grad\n@jax.named_scope('foo')\ndef f(x):\n\n    @jax.named_scope('scan_body')\n    def body(carry, x):\n        return (carry * x, carry + x)\n    return lax.scan(body, x, jnp.arange(8.0))[0]"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@pjit\ndef g(y):\n    return jnp.sin(y)"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    out = [rng(shape, dtype or jnp.float_) for shape, dtype in zip(shapes, dtypes)]\n    if np_arrays:\n        return out\n    return [jnp.asarray(a) if isinstance(a, (np.ndarray, np.generic)) else a for a in out]"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    out = [rng(shape, dtype or jnp.float_) for shape, dtype in zip(shapes, dtypes)]\n    if np_arrays:\n        return out\n    return [jnp.asarray(a) if isinstance(a, (np.ndarray, np.generic)) else a for a in out]"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    out = [rng(shape, dtype or jnp.float_) for shape, dtype in zip(shapes, dtypes)]\n    if np_arrays:\n        return out\n    return [jnp.asarray(a) if isinstance(a, (np.ndarray, np.generic)) else a for a in out]"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    out = [rng(shape, dtype or jnp.float_) for shape, dtype in zip(shapes, dtypes)]\n    if np_arrays:\n        return out\n    return [jnp.asarray(a) if isinstance(a, (np.ndarray, np.generic)) else a for a in out]"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    out = [rng(shape, dtype or jnp.float_) for shape, dtype in zip(shapes, dtypes)]\n    if np_arrays:\n        return out\n    return [jnp.asarray(a) if isinstance(a, (np.ndarray, np.generic)) else a for a in out]"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    out = [rng(shape, dtype or jnp.float_) for shape, dtype in zip(shapes, dtypes)]\n    if np_arrays:\n        return out\n    return [jnp.asarray(a) if isinstance(a, (np.ndarray, np.generic)) else a for a in out]"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    out = [rng(shape, dtype or jnp.float_) for shape, dtype in zip(shapes, dtypes)]\n    if np_arrays:\n        return out\n    return [jnp.asarray(a) if isinstance(a, (np.ndarray, np.generic)) else a for a in out]"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    out = [rng(shape, dtype or jnp.float_) for shape, dtype in zip(shapes, dtypes)]\n    if np_arrays:\n        return out\n    return [jnp.asarray(a) if isinstance(a, (np.ndarray, np.generic)) else a for a in out]"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    out = [rng(shape, dtype or jnp.float_) for shape, dtype in zip(shapes, dtypes)]\n    if np_arrays:\n        return out\n    return [jnp.asarray(a) if isinstance(a, (np.ndarray, np.generic)) else a for a in out]"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(c, a):\n    tracer_spy.append(c)\n    d = 0.75\n    b = jnp.sin(c * jnp.sum(jnp.cos(d * a)))\n    c = 0.9 * jnp.cos(d * jnp.sum(jnp.sin(c * a)))\n    return (c, b)"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(c, a):\n    tracer_spy.append(c)\n    d = 0.75\n    b = jnp.sin(c * jnp.sum(jnp.cos(d * a)))\n    c = 0.9 * jnp.cos(d * jnp.sum(jnp.sin(c * a)))\n    return (c, b)"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(c, a):\n    tracer_spy.append(c)\n    d = 0.75\n    b = jnp.sin(c * jnp.sum(jnp.cos(d * a)))\n    c = 0.9 * jnp.cos(d * jnp.sum(jnp.sin(c * a)))\n    return (c, b)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(c, a):\n    tracer_spy.append(c)\n    d = 0.75\n    b = jnp.sin(c * jnp.sum(jnp.cos(d * a)))\n    c = 0.9 * jnp.cos(d * jnp.sum(jnp.sin(c * a)))\n    return (c, b)"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(c, a):\n    tracer_spy.append(c)\n    d = 0.75\n    b = jnp.sin(c * jnp.sum(jnp.cos(d * a)))\n    c = 0.9 * jnp.cos(d * jnp.sum(jnp.sin(c * a)))\n    return (c, b)"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(c, a):\n    tracer_spy.append(c)\n    d = 0.75\n    b = jnp.sin(c * jnp.sum(jnp.cos(d * a)))\n    c = 0.9 * jnp.cos(d * jnp.sum(jnp.sin(c * a)))\n    return (c, b)"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(c, a):\n    tracer_spy.append(c)\n    d = 0.75\n    b = jnp.sin(c * jnp.sum(jnp.cos(d * a)))\n    c = 0.9 * jnp.cos(d * jnp.sum(jnp.sin(c * a)))\n    return (c, b)"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(c, a):\n    tracer_spy.append(c)\n    d = 0.75\n    b = jnp.sin(c * jnp.sum(jnp.cos(d * a)))\n    c = 0.9 * jnp.cos(d * jnp.sum(jnp.sin(c * a)))\n    return (c, b)"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(c, a):\n    tracer_spy.append(c)\n    d = 0.75\n    b = jnp.sin(c * jnp.sum(jnp.cos(d * a)))\n    c = 0.9 * jnp.cos(d * jnp.sum(jnp.sin(c * a)))\n    return (c, b)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.remat\ndef g(x):\n    jax.jit(lambda: 0 if jnp.add(1, 1) else 0)()\n    return lax.sin(x)"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(pred):\n\n    def true_fun():\n        x_ref[()] = 1.0\n\n    def false_fun():\n        x_ref[()] = 2.0\n    jax.lax.cond(pred, true_fun, false_fun)"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(pred):\n\n    def true_fun():\n        x_ref[()] = 1.0\n\n    def false_fun():\n        x_ref[()] = 2.0\n    jax.lax.cond(pred, true_fun, false_fun)"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(pred):\n\n    def true_fun():\n        x_ref[()] = 1.0\n\n    def false_fun():\n        x_ref[()] = 2.0\n    jax.lax.cond(pred, true_fun, false_fun)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(pred):\n\n    def true_fun():\n        x_ref[()] = 1.0\n\n    def false_fun():\n        x_ref[()] = 2.0\n    jax.lax.cond(pred, true_fun, false_fun)"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(pred):\n\n    def true_fun():\n        x_ref[()] = 1.0\n\n    def false_fun():\n        x_ref[()] = 2.0\n    jax.lax.cond(pred, true_fun, false_fun)"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(pred):\n\n    def true_fun():\n        x_ref[()] = 1.0\n\n    def false_fun():\n        x_ref[()] = 2.0\n    jax.lax.cond(pred, true_fun, false_fun)"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(pred):\n\n    def true_fun():\n        x_ref[()] = 1.0\n\n    def false_fun():\n        x_ref[()] = 2.0\n    jax.lax.cond(pred, true_fun, false_fun)"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(pred):\n\n    def true_fun():\n        x_ref[()] = 1.0\n\n    def false_fun():\n        x_ref[()] = 2.0\n    jax.lax.cond(pred, true_fun, false_fun)"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(pred):\n\n    def true_fun():\n        x_ref[()] = 1.0\n\n    def false_fun():\n        x_ref[()] = 2.0\n    jax.lax.cond(pred, true_fun, false_fun)"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(pjit.pjit, in_shardings=jax.sharding.PartitionSpec(None), out_shardings=jax.sharding.PartitionSpec('x'))\ndef f():\n    return jnp.zeros([32, 10])"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(pjit.pjit, in_shardings=jax.sharding.PartitionSpec(None), out_shardings=jax.sharding.PartitionSpec('x'))\ndef f():\n    return jnp.zeros([32, 10])"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(pjit.pjit, in_shardings=jax.sharding.PartitionSpec(None), out_shardings=jax.sharding.PartitionSpec('x'))\ndef f():\n    return jnp.zeros([32, 10])"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(pjit.pjit, in_shardings=jax.sharding.PartitionSpec(None), out_shardings=jax.sharding.PartitionSpec('x'))\ndef f():\n    return jnp.zeros([32, 10])"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(pjit.pjit, in_shardings=jax.sharding.PartitionSpec(None), out_shardings=jax.sharding.PartitionSpec('x'))\ndef f():\n    return jnp.zeros([32, 10])"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(pjit.pjit, in_shardings=jax.sharding.PartitionSpec(None), out_shardings=jax.sharding.PartitionSpec('x'))\ndef f():\n    return jnp.zeros([32, 10])"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(pjit.pjit, in_shardings=jax.sharding.PartitionSpec(None), out_shardings=jax.sharding.PartitionSpec('x'))\ndef f():\n    return jnp.zeros([32, 10])"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(pjit.pjit, in_shardings=jax.sharding.PartitionSpec(None), out_shardings=jax.sharding.PartitionSpec('x'))\ndef f():\n    return jnp.zeros([32, 10])"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(pjit.pjit, in_shardings=jax.sharding.PartitionSpec(None), out_shardings=jax.sharding.PartitionSpec('x'))\ndef f():\n    return jnp.zeros([32, 10])"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x, r):\n    x = x.at[:, 0].set(x[:, 0] / r)\n    return x"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x, r):\n    x = x.at[:, 0].set(x[:, 0] / r)\n    return x"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x, r):\n    x = x.at[:, 0].set(x[:, 0] / r)\n    return x"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x, r):\n    x = x.at[:, 0].set(x[:, 0] / r)\n    return x"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x, r):\n    x = x.at[:, 0].set(x[:, 0] / r)\n    return x"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x, r):\n    x = x.at[:, 0].set(x[:, 0] / r)\n    return x"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x, r):\n    x = x.at[:, 0].set(x[:, 0] / r)\n    return x"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x, r):\n    x = x.at[:, 0].set(x[:, 0] / r)\n    return x"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x, r):\n    x = x.at[:, 0].set(x[:, 0] / r)\n    return x"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef g(x):\n    if x > 0.0:\n        return x * 2\n    else:\n        return x + 2"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jnp.vectorize, excluded={1})\ndef f(x, y):\n    assert x.ndim == 0\n    assert y == 'foo'\n    return x"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jnp.vectorize, excluded={1})\ndef f(x, y):\n    assert x.ndim == 0\n    assert y == 'foo'\n    return x"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jnp.vectorize, excluded={1})\ndef f(x, y):\n    assert x.ndim == 0\n    assert y == 'foo'\n    return x"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jnp.vectorize, excluded={1})\ndef f(x, y):\n    assert x.ndim == 0\n    assert y == 'foo'\n    return x"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jnp.vectorize, excluded={1})\ndef f(x, y):\n    assert x.ndim == 0\n    assert y == 'foo'\n    return x"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jnp.vectorize, excluded={1})\ndef f(x, y):\n    assert x.ndim == 0\n    assert y == 'foo'\n    return x"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jnp.vectorize, excluded={1})\ndef f(x, y):\n    assert x.ndim == 0\n    assert y == 'foo'\n    return x"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jnp.vectorize, excluded={1})\ndef f(x, y):\n    assert x.ndim == 0\n    assert y == 'foo'\n    return x"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jnp.vectorize, excluded={1})\ndef f(x, y):\n    assert x.ndim == 0\n    assert y == 'foo'\n    return x"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.pmap\ndef f(x, y):\n    return x * y"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.pmap\ndef f(x, y):\n    return x * y"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.pmap\ndef f(x, y):\n    return x * y"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.pmap\ndef f(x, y):\n    return x * y"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.pmap\ndef f(x, y):\n    return x * y"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.pmap\ndef f(x, y):\n    return x * y"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.pmap\ndef f(x, y):\n    return x * y"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.pmap\ndef f(x, y):\n    return x * y"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.pmap\ndef f(x, y):\n    return x * y"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.pmap\ndef g(z):\n    return f(z, z + 77)"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x, y):\n    return jax.vmap(shard_alike, in_axes=(0, 1))(x, y)"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x, y):\n    return jax.vmap(shard_alike, in_axes=(0, 1))(x, y)"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x, y):\n    return jax.vmap(shard_alike, in_axes=(0, 1))(x, y)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x, y):\n    return jax.vmap(shard_alike, in_axes=(0, 1))(x, y)"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x, y):\n    return jax.vmap(shard_alike, in_axes=(0, 1))(x, y)"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x, y):\n    return jax.vmap(shard_alike, in_axes=(0, 1))(x, y)"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x, y):\n    return jax.vmap(shard_alike, in_axes=(0, 1))(x, y)"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x, y):\n    return jax.vmap(shard_alike, in_axes=(0, 1))(x, y)"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(x, y):\n    return jax.vmap(shard_alike, in_axes=(0, 1))(x, y)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef g(x):\n    z = x * 2\n    return shard_alike(x, z)"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    return random.uniform(self.make_key(3), (308000000, 128), dtype=jnp.bfloat16)"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    return random.uniform(self.make_key(3), (308000000, 128), dtype=jnp.bfloat16)"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    return random.uniform(self.make_key(3), (308000000, 128), dtype=jnp.bfloat16)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    return random.uniform(self.make_key(3), (308000000, 128), dtype=jnp.bfloat16)"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    return random.uniform(self.make_key(3), (308000000, 128), dtype=jnp.bfloat16)"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    return random.uniform(self.make_key(3), (308000000, 128), dtype=jnp.bfloat16)"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    return random.uniform(self.make_key(3), (308000000, 128), dtype=jnp.bfloat16)"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    return random.uniform(self.make_key(3), (308000000, 128), dtype=jnp.bfloat16)"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    return random.uniform(self.make_key(3), (308000000, 128), dtype=jnp.bfloat16)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.custom_jvp\ndef g(x):\n    return x"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    return jax.lax.convert_element_type(x, FooTy())"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    return jax.lax.convert_element_type(x, FooTy())"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    return jax.lax.convert_element_type(x, FooTy())"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    return jax.lax.convert_element_type(x, FooTy())"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    return jax.lax.convert_element_type(x, FooTy())"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    return jax.lax.convert_element_type(x, FooTy())"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    return jax.lax.convert_element_type(x, FooTy())"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    return jax.lax.convert_element_type(x, FooTy())"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    return jax.lax.convert_element_type(x, FooTy())"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    y = x * jnp.arange(3.0).reshape((1, 3))\n    return jnp.take_along_axis(y, idx, -1).sum()"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    y = x * jnp.arange(3.0).reshape((1, 3))\n    return jnp.take_along_axis(y, idx, -1).sum()"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    y = x * jnp.arange(3.0).reshape((1, 3))\n    return jnp.take_along_axis(y, idx, -1).sum()"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    y = x * jnp.arange(3.0).reshape((1, 3))\n    return jnp.take_along_axis(y, idx, -1).sum()"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    y = x * jnp.arange(3.0).reshape((1, 3))\n    return jnp.take_along_axis(y, idx, -1).sum()"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    y = x * jnp.arange(3.0).reshape((1, 3))\n    return jnp.take_along_axis(y, idx, -1).sum()"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    y = x * jnp.arange(3.0).reshape((1, 3))\n    return jnp.take_along_axis(y, idx, -1).sum()"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    y = x * jnp.arange(3.0).reshape((1, 3))\n    return jnp.take_along_axis(y, idx, -1).sum()"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    y = x * jnp.arange(3.0).reshape((1, 3))\n    return jnp.take_along_axis(y, idx, -1).sum()"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef g(x):\n    if x > 0.0:\n        return x * 2\n    else:\n        return x + 2"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(shard_map, mesh=mesh, in_specs=P('i'), out_specs=P())\ndef f(x):\n    return jax.lax.psum(((w * x) ** 2).sum(), 'i')"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(shard_map, mesh=mesh, in_specs=P('i'), out_specs=P())\ndef f(x):\n    return jax.lax.psum(((w * x) ** 2).sum(), 'i')"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(shard_map, mesh=mesh, in_specs=P('i'), out_specs=P())\ndef f(x):\n    return jax.lax.psum(((w * x) ** 2).sum(), 'i')"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(shard_map, mesh=mesh, in_specs=P('i'), out_specs=P())\ndef f(x):\n    return jax.lax.psum(((w * x) ** 2).sum(), 'i')"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(shard_map, mesh=mesh, in_specs=P('i'), out_specs=P())\ndef f(x):\n    return jax.lax.psum(((w * x) ** 2).sum(), 'i')"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(shard_map, mesh=mesh, in_specs=P('i'), out_specs=P())\ndef f(x):\n    return jax.lax.psum(((w * x) ** 2).sum(), 'i')"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(shard_map, mesh=mesh, in_specs=P('i'), out_specs=P())\ndef f(x):\n    return jax.lax.psum(((w * x) ** 2).sum(), 'i')"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(shard_map, mesh=mesh, in_specs=P('i'), out_specs=P())\ndef f(x):\n    return jax.lax.psum(((w * x) ** 2).sum(), 'i')"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(shard_map, mesh=mesh, in_specs=P('i'), out_specs=P())\ndef f(x):\n    return jax.lax.psum(((w * x) ** 2).sum(), 'i')"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(shard_map, mesh=mesh, in_specs=P('x', 'y'), out_specs=out_spec)\ndef g(x):\n    result = lax.psum(x, axis_name=reduce_along)\n\n    def check_rep(result):\n        self.assertEqual(jax.experimental.shard_map.get_replication(result), set(reduce_along))\n        return result\n    result = check_rep(result)\n    result = jax.vmap(check_rep)(result)\n    return result"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    out = [rng(shape, dtype or jnp.float_) for shape, dtype in zip(shapes, dtypes)]\n    if np_arrays:\n        return out\n    return [jnp.asarray(a) if isinstance(a, (np.ndarray, np.generic)) else a for a in out]"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    out = [rng(shape, dtype or jnp.float_) for shape, dtype in zip(shapes, dtypes)]\n    if np_arrays:\n        return out\n    return [jnp.asarray(a) if isinstance(a, (np.ndarray, np.generic)) else a for a in out]"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    out = [rng(shape, dtype or jnp.float_) for shape, dtype in zip(shapes, dtypes)]\n    if np_arrays:\n        return out\n    return [jnp.asarray(a) if isinstance(a, (np.ndarray, np.generic)) else a for a in out]"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    out = [rng(shape, dtype or jnp.float_) for shape, dtype in zip(shapes, dtypes)]\n    if np_arrays:\n        return out\n    return [jnp.asarray(a) if isinstance(a, (np.ndarray, np.generic)) else a for a in out]"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    out = [rng(shape, dtype or jnp.float_) for shape, dtype in zip(shapes, dtypes)]\n    if np_arrays:\n        return out\n    return [jnp.asarray(a) if isinstance(a, (np.ndarray, np.generic)) else a for a in out]"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    out = [rng(shape, dtype or jnp.float_) for shape, dtype in zip(shapes, dtypes)]\n    if np_arrays:\n        return out\n    return [jnp.asarray(a) if isinstance(a, (np.ndarray, np.generic)) else a for a in out]"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    out = [rng(shape, dtype or jnp.float_) for shape, dtype in zip(shapes, dtypes)]\n    if np_arrays:\n        return out\n    return [jnp.asarray(a) if isinstance(a, (np.ndarray, np.generic)) else a for a in out]"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    out = [rng(shape, dtype or jnp.float_) for shape, dtype in zip(shapes, dtypes)]\n    if np_arrays:\n        return out\n    return [jnp.asarray(a) if isinstance(a, (np.ndarray, np.generic)) else a for a in out]"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f():\n    out = [rng(shape, dtype or jnp.float_) for shape, dtype in zip(shapes, dtypes)]\n    if np_arrays:\n        return out\n    return [jnp.asarray(a) if isinstance(a, (np.ndarray, np.generic)) else a for a in out]"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(seed):\n    key = jax.random.key(seed)\n    return jax.random.uniform(key) + jax.random.normal(key)"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(seed):\n    key = jax.random.key(seed)\n    return jax.random.uniform(key) + jax.random.normal(key)"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(seed):\n    key = jax.random.key(seed)\n    return jax.random.uniform(key) + jax.random.normal(key)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(seed):\n    key = jax.random.key(seed)\n    return jax.random.uniform(key) + jax.random.normal(key)"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(seed):\n    key = jax.random.key(seed)\n    return jax.random.uniform(key) + jax.random.normal(key)"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(seed):\n    key = jax.random.key(seed)\n    return jax.random.uniform(key) + jax.random.normal(key)"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(seed):\n    key = jax.random.key(seed)\n    return jax.random.uniform(key) + jax.random.normal(key)"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(seed):\n    key = jax.random.key(seed)\n    return jax.random.uniform(key) + jax.random.normal(key)"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(seed):\n    key = jax.random.key(seed)\n    return jax.random.uniform(key) + jax.random.normal(key)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef g(x):\n    return x"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x_ref):\n    ones = jnp.ones_like(x_ref)[slc]\n    ref_primitives.ref_addupdate(x_ref, slc, ones)\n    x1 = ref_primitives.ref_get(x_ref, slc)\n    x2 = x1 + ones\n    ref_primitives.ref_set(x_ref, slc, x2)"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x_ref):\n    ones = jnp.ones_like(x_ref)[slc]\n    ref_primitives.ref_addupdate(x_ref, slc, ones)\n    x1 = ref_primitives.ref_get(x_ref, slc)\n    x2 = x1 + ones\n    ref_primitives.ref_set(x_ref, slc, x2)"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x_ref):\n    ones = jnp.ones_like(x_ref)[slc]\n    ref_primitives.ref_addupdate(x_ref, slc, ones)\n    x1 = ref_primitives.ref_get(x_ref, slc)\n    x2 = x1 + ones\n    ref_primitives.ref_set(x_ref, slc, x2)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x_ref):\n    ones = jnp.ones_like(x_ref)[slc]\n    ref_primitives.ref_addupdate(x_ref, slc, ones)\n    x1 = ref_primitives.ref_get(x_ref, slc)\n    x2 = x1 + ones\n    ref_primitives.ref_set(x_ref, slc, x2)"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x_ref):\n    ones = jnp.ones_like(x_ref)[slc]\n    ref_primitives.ref_addupdate(x_ref, slc, ones)\n    x1 = ref_primitives.ref_get(x_ref, slc)\n    x2 = x1 + ones\n    ref_primitives.ref_set(x_ref, slc, x2)"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x_ref):\n    ones = jnp.ones_like(x_ref)[slc]\n    ref_primitives.ref_addupdate(x_ref, slc, ones)\n    x1 = ref_primitives.ref_get(x_ref, slc)\n    x2 = x1 + ones\n    ref_primitives.ref_set(x_ref, slc, x2)"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x_ref):\n    ones = jnp.ones_like(x_ref)[slc]\n    ref_primitives.ref_addupdate(x_ref, slc, ones)\n    x1 = ref_primitives.ref_get(x_ref, slc)\n    x2 = x1 + ones\n    ref_primitives.ref_set(x_ref, slc, x2)"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x_ref):\n    ones = jnp.ones_like(x_ref)[slc]\n    ref_primitives.ref_addupdate(x_ref, slc, ones)\n    x1 = ref_primitives.ref_get(x_ref, slc)\n    x2 = x1 + ones\n    ref_primitives.ref_set(x_ref, slc, x2)"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x_ref):\n    ones = jnp.ones_like(x_ref)[slc]\n    ref_primitives.ref_addupdate(x_ref, slc, ones)\n    x1 = ref_primitives.ref_get(x_ref, slc)\n    x2 = x1 + ones\n    ref_primitives.ref_set(x_ref, slc, x2)"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(self, ys):\n    return lax.fori_loop(0, 10, loop_body, jnp.ones(4, np.float32))"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(self, ys):\n    return lax.fori_loop(0, 10, loop_body, jnp.ones(4, np.float32))"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(self, ys):\n    return lax.fori_loop(0, 10, loop_body, jnp.ones(4, np.float32))"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(self, ys):\n    return lax.fori_loop(0, 10, loop_body, jnp.ones(4, np.float32))"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(self, ys):\n    return lax.fori_loop(0, 10, loop_body, jnp.ones(4, np.float32))"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(self, ys):\n    return lax.fori_loop(0, 10, loop_body, jnp.ones(4, np.float32))"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(self, ys):\n    return lax.fori_loop(0, 10, loop_body, jnp.ones(4, np.float32))"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(self, ys):\n    return lax.fori_loop(0, 10, loop_body, jnp.ones(4, np.float32))"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(self, ys):\n    return lax.fori_loop(0, 10, loop_body, jnp.ones(4, np.float32))"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def g(x):\n    return jax.pure_callback(lambda x: x, x, x)"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(hx, _):\n    hx = jax.nn.sigmoid(hx + a)\n    return (hx, None)"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(hx, _):\n    hx = jax.nn.sigmoid(hx + a)\n    return (hx, None)"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(hx, _):\n    hx = jax.nn.sigmoid(hx + a)\n    return (hx, None)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(hx, _):\n    hx = jax.nn.sigmoid(hx + a)\n    return (hx, None)"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(hx, _):\n    hx = jax.nn.sigmoid(hx + a)\n    return (hx, None)"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(hx, _):\n    hx = jax.nn.sigmoid(hx + a)\n    return (hx, None)"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(hx, _):\n    hx = jax.nn.sigmoid(hx + a)\n    return (hx, None)"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(hx, _):\n    hx = jax.nn.sigmoid(hx + a)\n    return (hx, None)"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(hx, _):\n    hx = jax.nn.sigmoid(hx + a)\n    return (hx, None)"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    u, s, v = jnp.linalg.svd(a + x * b, full_matrices=full_matrices, compute_uv=compute_uv)\n    vdiag = jnp.vectorize(jnp.diag, signature='(k)->(k,k)')\n    return jnp.matmul(jnp.matmul(u, vdiag(s).astype(u.dtype)), v).real"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    u, s, v = jnp.linalg.svd(a + x * b, full_matrices=full_matrices, compute_uv=compute_uv)\n    vdiag = jnp.vectorize(jnp.diag, signature='(k)->(k,k)')\n    return jnp.matmul(jnp.matmul(u, vdiag(s).astype(u.dtype)), v).real"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    u, s, v = jnp.linalg.svd(a + x * b, full_matrices=full_matrices, compute_uv=compute_uv)\n    vdiag = jnp.vectorize(jnp.diag, signature='(k)->(k,k)')\n    return jnp.matmul(jnp.matmul(u, vdiag(s).astype(u.dtype)), v).real"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    u, s, v = jnp.linalg.svd(a + x * b, full_matrices=full_matrices, compute_uv=compute_uv)\n    vdiag = jnp.vectorize(jnp.diag, signature='(k)->(k,k)')\n    return jnp.matmul(jnp.matmul(u, vdiag(s).astype(u.dtype)), v).real"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    u, s, v = jnp.linalg.svd(a + x * b, full_matrices=full_matrices, compute_uv=compute_uv)\n    vdiag = jnp.vectorize(jnp.diag, signature='(k)->(k,k)')\n    return jnp.matmul(jnp.matmul(u, vdiag(s).astype(u.dtype)), v).real"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    u, s, v = jnp.linalg.svd(a + x * b, full_matrices=full_matrices, compute_uv=compute_uv)\n    vdiag = jnp.vectorize(jnp.diag, signature='(k)->(k,k)')\n    return jnp.matmul(jnp.matmul(u, vdiag(s).astype(u.dtype)), v).real"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    u, s, v = jnp.linalg.svd(a + x * b, full_matrices=full_matrices, compute_uv=compute_uv)\n    vdiag = jnp.vectorize(jnp.diag, signature='(k)->(k,k)')\n    return jnp.matmul(jnp.matmul(u, vdiag(s).astype(u.dtype)), v).real"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    u, s, v = jnp.linalg.svd(a + x * b, full_matrices=full_matrices, compute_uv=compute_uv)\n    vdiag = jnp.vectorize(jnp.diag, signature='(k)->(k,k)')\n    return jnp.matmul(jnp.matmul(u, vdiag(s).astype(u.dtype)), v).real"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    u, s, v = jnp.linalg.svd(a + x * b, full_matrices=full_matrices, compute_uv=compute_uv)\n    vdiag = jnp.vectorize(jnp.diag, signature='(k)->(k,k)')\n    return jnp.matmul(jnp.matmul(u, vdiag(s).astype(u.dtype)), v).real"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def g(a, b):\n    an, ai = a\n    bn, bi = b\n    which = an >= bn\n    return (jnp.where(which, an, bn), jnp.where(which, ai, bi))"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.profiler.annotate_function\ndef f(x, *, name):\n    return x + 2 * len(name)"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.profiler.annotate_function\ndef f(x, *, name):\n    return x + 2 * len(name)"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.profiler.annotate_function\ndef f(x, *, name):\n    return x + 2 * len(name)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.profiler.annotate_function\ndef f(x, *, name):\n    return x + 2 * len(name)"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.profiler.annotate_function\ndef f(x, *, name):\n    return x + 2 * len(name)"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.profiler.annotate_function\ndef f(x, *, name):\n    return x + 2 * len(name)"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.profiler.annotate_function\ndef f(x, *, name):\n    return x + 2 * len(name)"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.profiler.annotate_function\ndef f(x, *, name):\n    return x + 2 * len(name)"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.profiler.annotate_function\ndef f(x, *, name):\n    return x + 2 * len(name)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.profiler.annotate_function, name='aname')\ndef g(x):\n    return x + 2"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, out_shardings=out_layout, donate_argnums=0)\ndef f(x):\n    return x * 2"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, out_shardings=out_layout, donate_argnums=0)\ndef f(x):\n    return x * 2"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, out_shardings=out_layout, donate_argnums=0)\ndef f(x):\n    return x * 2"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, out_shardings=out_layout, donate_argnums=0)\ndef f(x):\n    return x * 2"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, out_shardings=out_layout, donate_argnums=0)\ndef f(x):\n    return x * 2"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, out_shardings=out_layout, donate_argnums=0)\ndef f(x):\n    return x * 2"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, out_shardings=out_layout, donate_argnums=0)\ndef f(x):\n    return x * 2"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, out_shardings=out_layout, donate_argnums=0)\ndef f(x):\n    return x * 2"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, out_shardings=out_layout, donate_argnums=0)\ndef f(x):\n    return x * 2"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, donate_argnums=0, out_shardings=Layout(DLL.AUTO))\ndef g(x):\n    return x * 2"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(z):\n    x_re = jnp.concatenate([jnp.real(z), jnp.imag(z)])\n    return f_re(x_re)"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(z):\n    x_re = jnp.concatenate([jnp.real(z), jnp.imag(z)])\n    return f_re(x_re)"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(z):\n    x_re = jnp.concatenate([jnp.real(z), jnp.imag(z)])\n    return f_re(x_re)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(z):\n    x_re = jnp.concatenate([jnp.real(z), jnp.imag(z)])\n    return f_re(x_re)"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(z):\n    x_re = jnp.concatenate([jnp.real(z), jnp.imag(z)])\n    return f_re(x_re)"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(z):\n    x_re = jnp.concatenate([jnp.real(z), jnp.imag(z)])\n    return f_re(x_re)"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(z):\n    x_re = jnp.concatenate([jnp.real(z), jnp.imag(z)])\n    return f_re(x_re)"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(z):\n    x_re = jnp.concatenate([jnp.real(z), jnp.imag(z)])\n    return f_re(x_re)"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(z):\n    x_re = jnp.concatenate([jnp.real(z), jnp.imag(z)])\n    return f_re(x_re)"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@run_state\ndef f(x_ref):\n    x = x_ref[...]\n\n    def _body(ref):\n        ref[...] = jnp.sin(ref[...])\n    x = run_state(_body)(x)\n    x_ref[...] = x"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@run_state\ndef f(x_ref):\n    x = x_ref[...]\n\n    def _body(ref):\n        ref[...] = jnp.sin(ref[...])\n    x = run_state(_body)(x)\n    x_ref[...] = x"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@run_state\ndef f(x_ref):\n    x = x_ref[...]\n\n    def _body(ref):\n        ref[...] = jnp.sin(ref[...])\n    x = run_state(_body)(x)\n    x_ref[...] = x"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@run_state\ndef f(x_ref):\n    x = x_ref[...]\n\n    def _body(ref):\n        ref[...] = jnp.sin(ref[...])\n    x = run_state(_body)(x)\n    x_ref[...] = x"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@run_state\ndef f(x_ref):\n    x = x_ref[...]\n\n    def _body(ref):\n        ref[...] = jnp.sin(ref[...])\n    x = run_state(_body)(x)\n    x_ref[...] = x"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@run_state\ndef f(x_ref):\n    x = x_ref[...]\n\n    def _body(ref):\n        ref[...] = jnp.sin(ref[...])\n    x = run_state(_body)(x)\n    x_ref[...] = x"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@run_state\ndef f(x_ref):\n    x = x_ref[...]\n\n    def _body(ref):\n        ref[...] = jnp.sin(ref[...])\n    x = run_state(_body)(x)\n    x_ref[...] = x"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@run_state\ndef f(x_ref):\n    x = x_ref[...]\n\n    def _body(ref):\n        ref[...] = jnp.sin(ref[...])\n    x = run_state(_body)(x)\n    x_ref[...] = x"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@run_state\ndef f(x_ref):\n    x = x_ref[...]\n\n    def _body(ref):\n        ref[...] = jnp.sin(ref[...])\n    x = run_state(_body)(x)\n    x_ref[...] = x"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef g():\n    x = x_ref[...] * y_ref[...]\n    y_ref[...] = x * 2\n    x_ref[...] = y_ref[...] + x_ref[...]"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(new_checkpoint, policy=policy)\ndef f(x):\n    x = jnp.einsum('ij,jk->ik', x, x, precision=lax.Precision.HIGHEST)\n    x = jnp.sin(x)\n    x = jnp.einsum('ij,jk->ik', x, x, precision=lax.Precision.HIGHEST)\n    x = jnp.sin(x)\n    x = jnp.einsum('ij,jk->ik', x, x, precision=lax.Precision.HIGHEST)\n    x = jnp.sin(x)\n    x = jnp.sum(x)\n    return x"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(new_checkpoint, policy=policy)\ndef f(x):\n    x = jnp.einsum('ij,jk->ik', x, x, precision=lax.Precision.HIGHEST)\n    x = jnp.sin(x)\n    x = jnp.einsum('ij,jk->ik', x, x, precision=lax.Precision.HIGHEST)\n    x = jnp.sin(x)\n    x = jnp.einsum('ij,jk->ik', x, x, precision=lax.Precision.HIGHEST)\n    x = jnp.sin(x)\n    x = jnp.sum(x)\n    return x"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(new_checkpoint, policy=policy)\ndef f(x):\n    x = jnp.einsum('ij,jk->ik', x, x, precision=lax.Precision.HIGHEST)\n    x = jnp.sin(x)\n    x = jnp.einsum('ij,jk->ik', x, x, precision=lax.Precision.HIGHEST)\n    x = jnp.sin(x)\n    x = jnp.einsum('ij,jk->ik', x, x, precision=lax.Precision.HIGHEST)\n    x = jnp.sin(x)\n    x = jnp.sum(x)\n    return x"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(new_checkpoint, policy=policy)\ndef f(x):\n    x = jnp.einsum('ij,jk->ik', x, x, precision=lax.Precision.HIGHEST)\n    x = jnp.sin(x)\n    x = jnp.einsum('ij,jk->ik', x, x, precision=lax.Precision.HIGHEST)\n    x = jnp.sin(x)\n    x = jnp.einsum('ij,jk->ik', x, x, precision=lax.Precision.HIGHEST)\n    x = jnp.sin(x)\n    x = jnp.sum(x)\n    return x"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(new_checkpoint, policy=policy)\ndef f(x):\n    x = jnp.einsum('ij,jk->ik', x, x, precision=lax.Precision.HIGHEST)\n    x = jnp.sin(x)\n    x = jnp.einsum('ij,jk->ik', x, x, precision=lax.Precision.HIGHEST)\n    x = jnp.sin(x)\n    x = jnp.einsum('ij,jk->ik', x, x, precision=lax.Precision.HIGHEST)\n    x = jnp.sin(x)\n    x = jnp.sum(x)\n    return x"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(new_checkpoint, policy=policy)\ndef f(x):\n    x = jnp.einsum('ij,jk->ik', x, x, precision=lax.Precision.HIGHEST)\n    x = jnp.sin(x)\n    x = jnp.einsum('ij,jk->ik', x, x, precision=lax.Precision.HIGHEST)\n    x = jnp.sin(x)\n    x = jnp.einsum('ij,jk->ik', x, x, precision=lax.Precision.HIGHEST)\n    x = jnp.sin(x)\n    x = jnp.sum(x)\n    return x"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(new_checkpoint, policy=policy)\ndef f(x):\n    x = jnp.einsum('ij,jk->ik', x, x, precision=lax.Precision.HIGHEST)\n    x = jnp.sin(x)\n    x = jnp.einsum('ij,jk->ik', x, x, precision=lax.Precision.HIGHEST)\n    x = jnp.sin(x)\n    x = jnp.einsum('ij,jk->ik', x, x, precision=lax.Precision.HIGHEST)\n    x = jnp.sin(x)\n    x = jnp.sum(x)\n    return x"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(new_checkpoint, policy=policy)\ndef f(x):\n    x = jnp.einsum('ij,jk->ik', x, x, precision=lax.Precision.HIGHEST)\n    x = jnp.sin(x)\n    x = jnp.einsum('ij,jk->ik', x, x, precision=lax.Precision.HIGHEST)\n    x = jnp.sin(x)\n    x = jnp.einsum('ij,jk->ik', x, x, precision=lax.Precision.HIGHEST)\n    x = jnp.sin(x)\n    x = jnp.sum(x)\n    return x"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(new_checkpoint, policy=policy)\ndef f(x):\n    x = jnp.einsum('ij,jk->ik', x, x, precision=lax.Precision.HIGHEST)\n    x = jnp.sin(x)\n    x = jnp.einsum('ij,jk->ik', x, x, precision=lax.Precision.HIGHEST)\n    x = jnp.sin(x)\n    x = jnp.einsum('ij,jk->ik', x, x, precision=lax.Precision.HIGHEST)\n    x = jnp.sin(x)\n    x = jnp.sum(x)\n    return x"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def g(ys, _):\n    y, _ = ys\n    y = checkpoint_name(jnp.sin(y), 'y')\n    z = checkpoint_name(jnp.sin(y), 'z')\n    z = jax.lax.with_sharding_constraint(z, s)\n    z = z.T\n    w = checkpoint_name(jnp.sin(z), 'w')\n    return ((w.T, jnp.sum(w)), None)"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(jax.jit, static_argnames=['c'])\ndef f(x, *, c):\n    return c * jnp.sin(x)"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(jax.jit, static_argnames=['c'])\ndef f(x, *, c):\n    return c * jnp.sin(x)"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(jax.jit, static_argnames=['c'])\ndef f(x, *, c):\n    return c * jnp.sin(x)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(jax.jit, static_argnames=['c'])\ndef f(x, *, c):\n    return c * jnp.sin(x)"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(jax.jit, static_argnames=['c'])\ndef f(x, *, c):\n    return c * jnp.sin(x)"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(jax.jit, static_argnames=['c'])\ndef f(x, *, c):\n    return c * jnp.sin(x)"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(jax.jit, static_argnames=['c'])\ndef f(x, *, c):\n    return c * jnp.sin(x)"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(jax.jit, static_argnames=['c'])\ndef f(x, *, c):\n    return c * jnp.sin(x)"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(jax.jit, static_argnames=['c'])\ndef f(x, *, c):\n    return c * jnp.sin(x)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@functools.partial(jax.jit, static_argnums=[1])\ndef g(x, c):\n    return c * jnp.sin(x)"
  },
  {
    "test_code": "def test_get_no_executable(self):\n    computation = jax.jit(lambda x, y: x + y).lower(1, 1).compiler_ir()\n    devices = np.array([[jax.local_devices()[0]]])\n    compile_options = compiler.get_compile_options(num_replicas=1, num_partitions=1)\n    backend = xla_bridge.get_backend()\n    key = cc.get_cache_key(computation, devices, compile_options, backend)\n    executable, compile_time = cc.get_executable_and_time(key, compile_options, backend)\n    self.assertIsNone(executable)\n    self.assertIsNone(compile_time)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def lower(self, x, _experimental_lowering_parameters=None):\n    return jax.jit(self.__call__).lower(x, _experimental_lowering_parameters=_experimental_lowering_parameters)"
  },
  {
    "test_code": "def test_diff_executables(self):\n    computation1 = str(jax.jit(lambda x, y: x + y).lower(1, 1).compiler_ir())\n    computation2 = str(jax.jit(lambda x, y: x * y).lower(2, 2).compiler_ir())\n    compile_options = compiler.get_compile_options(num_replicas=1, num_partitions=1)\n    backend = xla_bridge.get_backend()\n    executable1 = backend.compile(computation1, compile_options)\n    executable2 = backend.compile(computation2, compile_options)\n    cc.put_executable_and_time('key1', 'computation1', executable1, backend, FAKE_COMPILE_TIME)\n    cc.put_executable_and_time('key2', 'computation2', executable2, backend, FAKE_COMPILE_TIME)\n    self.assertNotEqual(cc.get_executable_and_time('key1', compile_options, backend)[0], cc.get_executable_and_time('key2', compile_options, backend)[0])",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def lower(self, x, _experimental_lowering_parameters=None):\n    return jax.jit(self.__call__).lower(x, _experimental_lowering_parameters=_experimental_lowering_parameters)"
  },
  {
    "test_code": "def test_put_executable(self):\n    computation = jax.jit(lambda x, y: x + y).lower(np.int32(1), np.int32(1)).compiler_ir()\n    devices = np.array([[jax.local_devices()[0]]])\n    compile_options = compiler.get_compile_options(num_replicas=1, num_partitions=1)\n    backend = xla_bridge.get_backend()\n    executable = backend.compile(str(computation), compile_options)\n    key = cc.get_cache_key(computation, devices, compile_options, backend)\n    cc.put_executable_and_time(key, 'alambda', executable, backend, FAKE_COMPILE_TIME)\n    executable_retrieved, compile_time_retrieved = cc.get_executable_and_time(key, compile_options, backend)\n    inputs_to_executable = (jnp.array(1, dtype=np.int32), jnp.array(2, dtype=np.int32))\n    expected = executable.execute(inputs_to_executable)\n    actual = executable_retrieved.execute(inputs_to_executable)\n    self.assertEqual(expected, actual)\n    self.assertEqual(FAKE_COMPILE_TIME, compile_time_retrieved)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def lower(self, x, _experimental_lowering_parameters=None):\n    return jax.jit(self.__call__).lower(x, _experimental_lowering_parameters=_experimental_lowering_parameters)"
  },
  {
    "test_code": "def test_backend_serialization_deserialization(self):\n    backend = xla_bridge.get_backend()\n    executable = jax.jit(lambda x, y: x + y).lower(np.array(1.0), np.array(1.0)).compile().runtime_executable()\n    serialized_executable = backend.serialize_executable(executable)\n    deserialized_executable = backend.deserialize_executable(serialized_executable, None)\n    self.assertEqual(executable.fingerprint, deserialized_executable.fingerprint)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def lower(self, x, _experimental_lowering_parameters=None):\n    return jax.jit(self.__call__).lower(x, _experimental_lowering_parameters=_experimental_lowering_parameters)"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n\n    @partial(map_fun, in_axes=1, out_axes=2)\n    def h(y):\n        return jnp.sin(x + y)\n    return h(y).sum()"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n\n    @partial(map_fun, in_axes=1, out_axes=2)\n    def h(y):\n        return jnp.sin(x + y)\n    return h(y).sum()"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n\n    @partial(map_fun, in_axes=1, out_axes=2)\n    def h(y):\n        return jnp.sin(x + y)\n    return h(y).sum()"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n\n    @partial(map_fun, in_axes=1, out_axes=2)\n    def h(y):\n        return jnp.sin(x + y)\n    return h(y).sum()"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n\n    @partial(map_fun, in_axes=1, out_axes=2)\n    def h(y):\n        return jnp.sin(x + y)\n    return h(y).sum()"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n\n    @partial(map_fun, in_axes=1, out_axes=2)\n    def h(y):\n        return jnp.sin(x + y)\n    return h(y).sum()"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n\n    @partial(map_fun, in_axes=1, out_axes=2)\n    def h(y):\n        return jnp.sin(x + y)\n    return h(y).sum()"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n\n    @partial(map_fun, in_axes=1, out_axes=2)\n    def h(y):\n        return jnp.sin(x + y)\n    return h(y).sum()"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n\n    @partial(map_fun, in_axes=1, out_axes=2)\n    def h(y):\n        return jnp.sin(x + y)\n    return h(y).sum()"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jit\ndef g(z):\n    return self.pmap(lambda x: x[jnp.newaxis] * y)(z)"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(carry, x):\n    return (carry + jax.lax.psum(jnp.sum(x), axis_name='x'), None)"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(carry, x):\n    return (carry + jax.lax.psum(jnp.sum(x), axis_name='x'), None)"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(carry, x):\n    return (carry + jax.lax.psum(jnp.sum(x), axis_name='x'), None)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(carry, x):\n    return (carry + jax.lax.psum(jnp.sum(x), axis_name='x'), None)"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(carry, x):\n    return (carry + jax.lax.psum(jnp.sum(x), axis_name='x'), None)"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(carry, x):\n    return (carry + jax.lax.psum(jnp.sum(x), axis_name='x'), None)"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(carry, x):\n    return (carry + jax.lax.psum(jnp.sum(x), axis_name='x'), None)"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(carry, x):\n    return (carry + jax.lax.psum(jnp.sum(x), axis_name='x'), None)"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(carry, x):\n    return (carry + jax.lax.psum(jnp.sum(x), axis_name='x'), None)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef g(y):\n    return y"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(k1, k2, k3, k4):\n    batch_size = 1\n    seq_len = 1\n    input_size = 1\n    hidden_size = 1\n    bidirectional = False\n    num_directions = 2 if bidirectional else 1\n    num_layers = 1\n    x = jax.random.normal(k1, (batch_size, seq_len, input_size), dtype=jnp.float32)\n    h_0 = jax.random.normal(k2, (num_directions * num_layers, batch_size, hidden_size), dtype=jnp.float32)\n    c_0 = jax.random.normal(k3, (num_directions * num_layers, batch_size, hidden_size), dtype=jnp.float32)\n    seq_lengths = jnp.ones((batch_size,), dtype=jnp.int32) * seq_len\n    weights = rnn.init_lstm_weight(k4, input_size, hidden_size, num_layers, bidirectional)\n    return rnn.lstm(x, h_0, c_0, weights, seq_lengths=seq_lengths, input_size=input_size, hidden_size=hidden_size, num_layers=num_layers, dropout=False, bidirectional=bidirectional)"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(k1, k2, k3, k4):\n    batch_size = 1\n    seq_len = 1\n    input_size = 1\n    hidden_size = 1\n    bidirectional = False\n    num_directions = 2 if bidirectional else 1\n    num_layers = 1\n    x = jax.random.normal(k1, (batch_size, seq_len, input_size), dtype=jnp.float32)\n    h_0 = jax.random.normal(k2, (num_directions * num_layers, batch_size, hidden_size), dtype=jnp.float32)\n    c_0 = jax.random.normal(k3, (num_directions * num_layers, batch_size, hidden_size), dtype=jnp.float32)\n    seq_lengths = jnp.ones((batch_size,), dtype=jnp.int32) * seq_len\n    weights = rnn.init_lstm_weight(k4, input_size, hidden_size, num_layers, bidirectional)\n    return rnn.lstm(x, h_0, c_0, weights, seq_lengths=seq_lengths, input_size=input_size, hidden_size=hidden_size, num_layers=num_layers, dropout=False, bidirectional=bidirectional)"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(k1, k2, k3, k4):\n    batch_size = 1\n    seq_len = 1\n    input_size = 1\n    hidden_size = 1\n    bidirectional = False\n    num_directions = 2 if bidirectional else 1\n    num_layers = 1\n    x = jax.random.normal(k1, (batch_size, seq_len, input_size), dtype=jnp.float32)\n    h_0 = jax.random.normal(k2, (num_directions * num_layers, batch_size, hidden_size), dtype=jnp.float32)\n    c_0 = jax.random.normal(k3, (num_directions * num_layers, batch_size, hidden_size), dtype=jnp.float32)\n    seq_lengths = jnp.ones((batch_size,), dtype=jnp.int32) * seq_len\n    weights = rnn.init_lstm_weight(k4, input_size, hidden_size, num_layers, bidirectional)\n    return rnn.lstm(x, h_0, c_0, weights, seq_lengths=seq_lengths, input_size=input_size, hidden_size=hidden_size, num_layers=num_layers, dropout=False, bidirectional=bidirectional)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(k1, k2, k3, k4):\n    batch_size = 1\n    seq_len = 1\n    input_size = 1\n    hidden_size = 1\n    bidirectional = False\n    num_directions = 2 if bidirectional else 1\n    num_layers = 1\n    x = jax.random.normal(k1, (batch_size, seq_len, input_size), dtype=jnp.float32)\n    h_0 = jax.random.normal(k2, (num_directions * num_layers, batch_size, hidden_size), dtype=jnp.float32)\n    c_0 = jax.random.normal(k3, (num_directions * num_layers, batch_size, hidden_size), dtype=jnp.float32)\n    seq_lengths = jnp.ones((batch_size,), dtype=jnp.int32) * seq_len\n    weights = rnn.init_lstm_weight(k4, input_size, hidden_size, num_layers, bidirectional)\n    return rnn.lstm(x, h_0, c_0, weights, seq_lengths=seq_lengths, input_size=input_size, hidden_size=hidden_size, num_layers=num_layers, dropout=False, bidirectional=bidirectional)"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(k1, k2, k3, k4):\n    batch_size = 1\n    seq_len = 1\n    input_size = 1\n    hidden_size = 1\n    bidirectional = False\n    num_directions = 2 if bidirectional else 1\n    num_layers = 1\n    x = jax.random.normal(k1, (batch_size, seq_len, input_size), dtype=jnp.float32)\n    h_0 = jax.random.normal(k2, (num_directions * num_layers, batch_size, hidden_size), dtype=jnp.float32)\n    c_0 = jax.random.normal(k3, (num_directions * num_layers, batch_size, hidden_size), dtype=jnp.float32)\n    seq_lengths = jnp.ones((batch_size,), dtype=jnp.int32) * seq_len\n    weights = rnn.init_lstm_weight(k4, input_size, hidden_size, num_layers, bidirectional)\n    return rnn.lstm(x, h_0, c_0, weights, seq_lengths=seq_lengths, input_size=input_size, hidden_size=hidden_size, num_layers=num_layers, dropout=False, bidirectional=bidirectional)"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(k1, k2, k3, k4):\n    batch_size = 1\n    seq_len = 1\n    input_size = 1\n    hidden_size = 1\n    bidirectional = False\n    num_directions = 2 if bidirectional else 1\n    num_layers = 1\n    x = jax.random.normal(k1, (batch_size, seq_len, input_size), dtype=jnp.float32)\n    h_0 = jax.random.normal(k2, (num_directions * num_layers, batch_size, hidden_size), dtype=jnp.float32)\n    c_0 = jax.random.normal(k3, (num_directions * num_layers, batch_size, hidden_size), dtype=jnp.float32)\n    seq_lengths = jnp.ones((batch_size,), dtype=jnp.int32) * seq_len\n    weights = rnn.init_lstm_weight(k4, input_size, hidden_size, num_layers, bidirectional)\n    return rnn.lstm(x, h_0, c_0, weights, seq_lengths=seq_lengths, input_size=input_size, hidden_size=hidden_size, num_layers=num_layers, dropout=False, bidirectional=bidirectional)"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(k1, k2, k3, k4):\n    batch_size = 1\n    seq_len = 1\n    input_size = 1\n    hidden_size = 1\n    bidirectional = False\n    num_directions = 2 if bidirectional else 1\n    num_layers = 1\n    x = jax.random.normal(k1, (batch_size, seq_len, input_size), dtype=jnp.float32)\n    h_0 = jax.random.normal(k2, (num_directions * num_layers, batch_size, hidden_size), dtype=jnp.float32)\n    c_0 = jax.random.normal(k3, (num_directions * num_layers, batch_size, hidden_size), dtype=jnp.float32)\n    seq_lengths = jnp.ones((batch_size,), dtype=jnp.int32) * seq_len\n    weights = rnn.init_lstm_weight(k4, input_size, hidden_size, num_layers, bidirectional)\n    return rnn.lstm(x, h_0, c_0, weights, seq_lengths=seq_lengths, input_size=input_size, hidden_size=hidden_size, num_layers=num_layers, dropout=False, bidirectional=bidirectional)"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(k1, k2, k3, k4):\n    batch_size = 1\n    seq_len = 1\n    input_size = 1\n    hidden_size = 1\n    bidirectional = False\n    num_directions = 2 if bidirectional else 1\n    num_layers = 1\n    x = jax.random.normal(k1, (batch_size, seq_len, input_size), dtype=jnp.float32)\n    h_0 = jax.random.normal(k2, (num_directions * num_layers, batch_size, hidden_size), dtype=jnp.float32)\n    c_0 = jax.random.normal(k3, (num_directions * num_layers, batch_size, hidden_size), dtype=jnp.float32)\n    seq_lengths = jnp.ones((batch_size,), dtype=jnp.int32) * seq_len\n    weights = rnn.init_lstm_weight(k4, input_size, hidden_size, num_layers, bidirectional)\n    return rnn.lstm(x, h_0, c_0, weights, seq_lengths=seq_lengths, input_size=input_size, hidden_size=hidden_size, num_layers=num_layers, dropout=False, bidirectional=bidirectional)"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(k1, k2, k3, k4):\n    batch_size = 1\n    seq_len = 1\n    input_size = 1\n    hidden_size = 1\n    bidirectional = False\n    num_directions = 2 if bidirectional else 1\n    num_layers = 1\n    x = jax.random.normal(k1, (batch_size, seq_len, input_size), dtype=jnp.float32)\n    h_0 = jax.random.normal(k2, (num_directions * num_layers, batch_size, hidden_size), dtype=jnp.float32)\n    c_0 = jax.random.normal(k3, (num_directions * num_layers, batch_size, hidden_size), dtype=jnp.float32)\n    seq_lengths = jnp.ones((batch_size,), dtype=jnp.int32) * seq_len\n    weights = rnn.init_lstm_weight(k4, input_size, hidden_size, num_layers, bidirectional)\n    return rnn.lstm(x, h_0, c_0, weights, seq_lengths=seq_lengths, input_size=input_size, hidden_size=hidden_size, num_layers=num_layers, dropout=False, bidirectional=bidirectional)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def g(weights, x, h_0, c_0):\n    W_ih, W_hh, b_ih, b_hh = rnn.unpack_lstm_weights(weights, input_size, hidden_size, num_layers, bidirectional)\n    y_ref, h_n_ref, c_n_ref = rnn.lstm_ref(x, h_0, c_0, W_ih, W_hh, b_ih, b_hh, seq_lengths=seq_lengths, input_size=input_size, hidden_size=hidden_size, num_layers=num_layers, dropout=False, bidirectional=bidirectional)\n    seq_length_mask = jnp.tile(jnp.arange(seq_len, dtype=jnp.int32)[None], [batch_size, 1]) < seq_lengths[:, None]\n    loss = jnp.sum(jnp.where(seq_length_mask[..., None], y_ref, 0.0))\n    return (loss, (y_ref, h_n_ref, c_n_ref))"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@colocated_python.colocated_python\ndef f(x):\n    out_arrays = []\n    for shard in x.addressable_shards:\n        np_array = jax.device_get(shard.data)\n        input_ints = struct.unpack('<ii', base64.b64decode(np_array[0].encode('ascii')))\n        output_string = base64.b64encode(struct.pack('<ii', input_ints[0] + 1, input_ints[1] + 1)).decode('ascii')\n        out_np_array = np.array([output_string], dtype=np.dtypes.StringDType())\n        out_arrays.append(jax.device_put(out_np_array, device=shard.device))\n    out = jax.make_array_from_single_device_arrays(sharding=x.sharding, shape=x.shape, arrays=out_arrays)\n    return out"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@colocated_python.colocated_python\ndef f(x):\n    out_arrays = []\n    for shard in x.addressable_shards:\n        np_array = jax.device_get(shard.data)\n        input_ints = struct.unpack('<ii', base64.b64decode(np_array[0].encode('ascii')))\n        output_string = base64.b64encode(struct.pack('<ii', input_ints[0] + 1, input_ints[1] + 1)).decode('ascii')\n        out_np_array = np.array([output_string], dtype=np.dtypes.StringDType())\n        out_arrays.append(jax.device_put(out_np_array, device=shard.device))\n    out = jax.make_array_from_single_device_arrays(sharding=x.sharding, shape=x.shape, arrays=out_arrays)\n    return out"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@colocated_python.colocated_python\ndef f(x):\n    out_arrays = []\n    for shard in x.addressable_shards:\n        np_array = jax.device_get(shard.data)\n        input_ints = struct.unpack('<ii', base64.b64decode(np_array[0].encode('ascii')))\n        output_string = base64.b64encode(struct.pack('<ii', input_ints[0] + 1, input_ints[1] + 1)).decode('ascii')\n        out_np_array = np.array([output_string], dtype=np.dtypes.StringDType())\n        out_arrays.append(jax.device_put(out_np_array, device=shard.device))\n    out = jax.make_array_from_single_device_arrays(sharding=x.sharding, shape=x.shape, arrays=out_arrays)\n    return out"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@colocated_python.colocated_python\ndef f(x):\n    out_arrays = []\n    for shard in x.addressable_shards:\n        np_array = jax.device_get(shard.data)\n        input_ints = struct.unpack('<ii', base64.b64decode(np_array[0].encode('ascii')))\n        output_string = base64.b64encode(struct.pack('<ii', input_ints[0] + 1, input_ints[1] + 1)).decode('ascii')\n        out_np_array = np.array([output_string], dtype=np.dtypes.StringDType())\n        out_arrays.append(jax.device_put(out_np_array, device=shard.device))\n    out = jax.make_array_from_single_device_arrays(sharding=x.sharding, shape=x.shape, arrays=out_arrays)\n    return out"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@colocated_python.colocated_python\ndef f(x):\n    out_arrays = []\n    for shard in x.addressable_shards:\n        np_array = jax.device_get(shard.data)\n        input_ints = struct.unpack('<ii', base64.b64decode(np_array[0].encode('ascii')))\n        output_string = base64.b64encode(struct.pack('<ii', input_ints[0] + 1, input_ints[1] + 1)).decode('ascii')\n        out_np_array = np.array([output_string], dtype=np.dtypes.StringDType())\n        out_arrays.append(jax.device_put(out_np_array, device=shard.device))\n    out = jax.make_array_from_single_device_arrays(sharding=x.sharding, shape=x.shape, arrays=out_arrays)\n    return out"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@colocated_python.colocated_python\ndef f(x):\n    out_arrays = []\n    for shard in x.addressable_shards:\n        np_array = jax.device_get(shard.data)\n        input_ints = struct.unpack('<ii', base64.b64decode(np_array[0].encode('ascii')))\n        output_string = base64.b64encode(struct.pack('<ii', input_ints[0] + 1, input_ints[1] + 1)).decode('ascii')\n        out_np_array = np.array([output_string], dtype=np.dtypes.StringDType())\n        out_arrays.append(jax.device_put(out_np_array, device=shard.device))\n    out = jax.make_array_from_single_device_arrays(sharding=x.sharding, shape=x.shape, arrays=out_arrays)\n    return out"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@colocated_python.colocated_python\ndef f(x):\n    out_arrays = []\n    for shard in x.addressable_shards:\n        np_array = jax.device_get(shard.data)\n        input_ints = struct.unpack('<ii', base64.b64decode(np_array[0].encode('ascii')))\n        output_string = base64.b64encode(struct.pack('<ii', input_ints[0] + 1, input_ints[1] + 1)).decode('ascii')\n        out_np_array = np.array([output_string], dtype=np.dtypes.StringDType())\n        out_arrays.append(jax.device_put(out_np_array, device=shard.device))\n    out = jax.make_array_from_single_device_arrays(sharding=x.sharding, shape=x.shape, arrays=out_arrays)\n    return out"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@colocated_python.colocated_python\ndef f(x):\n    out_arrays = []\n    for shard in x.addressable_shards:\n        np_array = jax.device_get(shard.data)\n        input_ints = struct.unpack('<ii', base64.b64decode(np_array[0].encode('ascii')))\n        output_string = base64.b64encode(struct.pack('<ii', input_ints[0] + 1, input_ints[1] + 1)).decode('ascii')\n        out_np_array = np.array([output_string], dtype=np.dtypes.StringDType())\n        out_arrays.append(jax.device_put(out_np_array, device=shard.device))\n    out = jax.make_array_from_single_device_arrays(sharding=x.sharding, shape=x.shape, arrays=out_arrays)\n    return out"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@colocated_python.colocated_python\ndef f(x):\n    out_arrays = []\n    for shard in x.addressable_shards:\n        np_array = jax.device_get(shard.data)\n        input_ints = struct.unpack('<ii', base64.b64decode(np_array[0].encode('ascii')))\n        output_string = base64.b64encode(struct.pack('<ii', input_ints[0] + 1, input_ints[1] + 1)).decode('ascii')\n        out_np_array = np.array([output_string], dtype=np.dtypes.StringDType())\n        out_arrays.append(jax.device_put(out_np_array, device=shard.device))\n    out = jax.make_array_from_single_device_arrays(sharding=x.sharding, shape=x.shape, arrays=out_arrays)\n    return out"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n    s = jit(jnp.sin)(x)\n    return jnp.sin(s) + jnp.cos(y)"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n    s = jit(jnp.sin)(x)\n    return jnp.sin(s) + jnp.cos(y)"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n    s = jit(jnp.sin)(x)\n    return jnp.sin(s) + jnp.cos(y)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n    s = jit(jnp.sin)(x)\n    return jnp.sin(s) + jnp.cos(y)"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n    s = jit(jnp.sin)(x)\n    return jnp.sin(s) + jnp.cos(y)"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n    s = jit(jnp.sin)(x)\n    return jnp.sin(s) + jnp.cos(y)"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n    s = jit(jnp.sin)(x)\n    return jnp.sin(s) + jnp.cos(y)"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n    s = jit(jnp.sin)(x)\n    return jnp.sin(s) + jnp.cos(y)"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x, y):\n    s = jit(jnp.sin)(x)\n    return jnp.sin(s) + jnp.cos(y)"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, in_shardings=NamedSharding(mesh, PartitionSpec('x')), out_shardings=NamedSharding(mesh, PartitionSpec('x')), compiler_options=compiler_options)\ndef f(x):\n    agg = x\n    for _ in range(its):\n        agg = agg @ x\n    return agg"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, in_shardings=NamedSharding(mesh, PartitionSpec('x')), out_shardings=NamedSharding(mesh, PartitionSpec('x')), compiler_options=compiler_options)\ndef f(x):\n    agg = x\n    for _ in range(its):\n        agg = agg @ x\n    return agg"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, in_shardings=NamedSharding(mesh, PartitionSpec('x')), out_shardings=NamedSharding(mesh, PartitionSpec('x')), compiler_options=compiler_options)\ndef f(x):\n    agg = x\n    for _ in range(its):\n        agg = agg @ x\n    return agg"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, in_shardings=NamedSharding(mesh, PartitionSpec('x')), out_shardings=NamedSharding(mesh, PartitionSpec('x')), compiler_options=compiler_options)\ndef f(x):\n    agg = x\n    for _ in range(its):\n        agg = agg @ x\n    return agg"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, in_shardings=NamedSharding(mesh, PartitionSpec('x')), out_shardings=NamedSharding(mesh, PartitionSpec('x')), compiler_options=compiler_options)\ndef f(x):\n    agg = x\n    for _ in range(its):\n        agg = agg @ x\n    return agg"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, in_shardings=NamedSharding(mesh, PartitionSpec('x')), out_shardings=NamedSharding(mesh, PartitionSpec('x')), compiler_options=compiler_options)\ndef f(x):\n    agg = x\n    for _ in range(its):\n        agg = agg @ x\n    return agg"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, in_shardings=NamedSharding(mesh, PartitionSpec('x')), out_shardings=NamedSharding(mesh, PartitionSpec('x')), compiler_options=compiler_options)\ndef f(x):\n    agg = x\n    for _ in range(its):\n        agg = agg @ x\n    return agg"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, in_shardings=NamedSharding(mesh, PartitionSpec('x')), out_shardings=NamedSharding(mesh, PartitionSpec('x')), compiler_options=compiler_options)\ndef f(x):\n    agg = x\n    for _ in range(its):\n        agg = agg @ x\n    return agg"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@partial(jax.jit, in_shardings=NamedSharding(mesh, PartitionSpec('x')), out_shardings=NamedSharding(mesh, PartitionSpec('x')), compiler_options=compiler_options)\ndef f(x):\n    agg = x\n    for _ in range(its):\n        agg = agg @ x\n    return agg"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef g(x):\n    return x + 4"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(_, y):\n    input_effect(y, index=0)"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(_, y):\n    input_effect(y, index=0)"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(_, y):\n    input_effect(y, index=0)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(_, y):\n    input_effect(y, index=0)"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(_, y):\n    input_effect(y, index=0)"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(_, y):\n    input_effect(y, index=0)"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(_, y):\n    input_effect(y, index=0)"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(_, y):\n    input_effect(y, index=0)"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef f(_, y):\n    input_effect(y, index=0)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@jax.jit\ndef g(x):\n    return callback_p.bind(x, callback=log_value, effect=log_effect, out_avals=[])"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@checkify.checkify\ndef f():\n    checkify.check(x > 0, 'must be positive!')\n    return jnp.log(x)"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@checkify.checkify\ndef f():\n    checkify.check(x > 0, 'must be positive!')\n    return jnp.log(x)"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@checkify.checkify\ndef f():\n    checkify.check(x > 0, 'must be positive!')\n    return jnp.log(x)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@checkify.checkify\ndef f():\n    checkify.check(x > 0, 'must be positive!')\n    return jnp.log(x)"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@checkify.checkify\ndef f():\n    checkify.check(x > 0, 'must be positive!')\n    return jnp.log(x)"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@checkify.checkify\ndef f():\n    checkify.check(x > 0, 'must be positive!')\n    return jnp.log(x)"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@checkify.checkify\ndef f():\n    checkify.check(x > 0, 'must be positive!')\n    return jnp.log(x)"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@checkify.checkify\ndef f():\n    checkify.check(x > 0, 'must be positive!')\n    return jnp.log(x)"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "@checkify.checkify\ndef f():\n    checkify.check(x > 0, 'must be positive!')\n    return jnp.log(x)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def g(x):\n    branch = jax.named_call(lambda x: x)\n    out = jax.lax.cond(True, branch, branch, x)\n    return out"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(z):\n    y = odeint(dz_dt, z, jnp.arange(10.0))\n    return jnp.sum(y)"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(z):\n    y = odeint(dz_dt, z, jnp.arange(10.0))\n    return jnp.sum(y)"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(z):\n    y = odeint(dz_dt, z, jnp.arange(10.0))\n    return jnp.sum(y)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(z):\n    y = odeint(dz_dt, z, jnp.arange(10.0))\n    return jnp.sum(y)"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(z):\n    y = odeint(dz_dt, z, jnp.arange(10.0))\n    return jnp.sum(y)"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(z):\n    y = odeint(dz_dt, z, jnp.arange(10.0))\n    return jnp.sum(y)"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(z):\n    y = odeint(dz_dt, z, jnp.arange(10.0))\n    return jnp.sum(y)"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(z):\n    y = odeint(dz_dt, z, jnp.arange(10.0))\n    return jnp.sum(y)"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(z):\n    y = odeint(dz_dt, z, jnp.arange(10.0))\n    return jnp.sum(y)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def g(x):\n    y0_arr = jnp.array([[x, 0.1], [x, 0.2]])\n    t = jnp.array([0.0, 5.0])\n    y = jax.vmap(lambda y0: odeint(dx_dt, y0, t))(y0_arr)\n    return y[:, -1].sum()"
  },
  {
    "test_code": "def test_pmap(self):\n    f = pmap(lambda x: x - lax.psum(x, 'i'), axis_name='i')\n    x = np.arange(jax.device_count(), dtype=np.int64)\n    f(x)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(jax.device_count(), dtype=np.float32)\n    f(x)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    return x.at[1].apply(jax.numpy.sin)"
  },
  {
    "test_code": "def test_jit(self):\n    f = jit(lambda x: x * x)\n    f(1)\n    self.assertEqual(count_cache_items(), 1)\n    f(1.0)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    return x.at[1].apply(jax.numpy.sin)"
  },
  {
    "test_code": "def test_set_cache_dir_after_backends_init(self):\n    with config.compilation_cache_dir(None):\n        cc.reset_cache()\n        backend = xla_bridge.get_backend()\n        a = jnp.zeros((2, 3))\n        self.assertFalse(cc.is_persistent_cache_enabled())\n        cache = cc._get_cache(backend)\n        self.assertIsNone(cache)\n        with tempfile.TemporaryDirectory() as tmp_cache_dir:\n            with config.compilation_cache_dir(tmp_cache_dir):\n                f = jit(lambda x: x + 1)\n                f(a)\n                self.assertTrue(cc.is_persistent_cache_enabled())\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    return x.at[1].apply(jax.numpy.sin)"
  },
  {
    "test_code": "def test_enable_compilation_cache(self):\n    with tempfile.TemporaryDirectory() as tmp_cache_dir:\n        with config.enable_compilation_cache(False), config.compilation_cache_dir(tmp_cache_dir):\n            cc.reset_cache()\n            backend = xla_bridge.get_backend()\n            f = jit(lambda x: x + 1)\n            f(1)\n            cache = cc._get_cache(backend)\n            self.assertIsNone(cache)\n            with config.enable_compilation_cache(True):\n                cc.reset_cache()\n                backend = xla_bridge.get_backend()\n                g = jit(lambda x: x * 3)\n                g(2)\n                cache = cc._get_cache(backend)\n                self.assertIsNotNone(cache)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    return x.at[1].apply(jax.numpy.sin)"
  },
  {
    "test_code": "def test_xla_autofdo_profile_version(self):\n    original_profile_version = config.jax_xla_profile_version.value\n    with config.jax_xla_profile_version(original_profile_version + 1):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 1)\n        clear_cache()\n        with config.jax_xla_profile_version(original_profile_version + 2):\n            f(1)\n            self.assertEqual(count_cache_items(), 1)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    return x.at[1].apply(jax.numpy.sin)"
  },
  {
    "test_code": "@jtu.with_mesh([('x', 2)])\ndef test_pjit(self):\n\n    @partial(pjit, in_shardings=(P('x'), P('x')), out_shardings=None)\n    def f(x, y):\n        return x + y\n    shape = (8, 8)\n    x = np.arange(math.prod(shape), dtype=np.int64).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 1)\n    x = np.arange(math.prod(shape), dtype=np.float32).reshape(shape)\n    f(x, x + 1)\n    self.assertEqual(count_cache_items(), 2)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    return x.at[1].apply(jax.numpy.sin)"
  },
  {
    "test_code": "def test_cache_write_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'put') as mock_put, test_warning_util.record_warnings() as w:\n        mock_put.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error writing persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    return x.at[1].apply(jax.numpy.sin)"
  },
  {
    "test_code": "def test_cache_read_warning(self):\n    f = jit(lambda x: x * x)\n    backend = xla_bridge.get_backend()\n    with config.raise_persistent_cache_errors(False), mock.patch.object(cc._get_cache(backend).__class__, 'get') as mock_get, test_warning_util.record_warnings() as w:\n        mock_get.side_effect = RuntimeError('test error')\n        self.assertEqual(f(2).item(), 4)\n    if len(w) != 1:\n        print('Warnings:', [str(w_) for w_ in w], flush=True)\n    self.assertLen(w, 1)\n    self.assertIn(\"Error reading persistent compilation cache entry for 'jit__lambda_': RuntimeError: test error\", str(w[0].message))",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    return x.at[1].apply(jax.numpy.sin)"
  },
  {
    "test_code": "def test_jit(self):\n    with config.enable_compilation_cache(False):\n        f = jit(lambda x: x * x)\n        f(1)\n        self.assertEqual(count_cache_items(), 0)",
    "assertions": [],
    "test_file": "/var/folders/q5/p2sqhr0d6nqb_h8x_fxyxpz80000gn/T/tmp_1jzy6em/jax/tests/compilation_cache_test.py",
    "function": "def f(x):\n    return x.at[1].apply(jax.numpy.sin)"
  }
]